<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Universal Spatial Join - Complete Implementation — universal_spatial_join • geospatialsuite</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Universal Spatial Join - Complete Implementation — universal_spatial_join"><meta name="description" content="Comprehensive spatial join system that handles ALL spatial data combinations:
Vector to Vector, Vector to Raster, Raster to Raster with full documentation,
error handling, and extensive examples. This replaces all previous spatial
join functions with a unified, robust system."><meta property="og:description" content="Comprehensive spatial join system that handles ALL spatial data combinations:
Vector to Vector, Vector to Raster, Raster to Raster with full documentation,
error handling, and extensive examples. This replaces all previous spatial
join functions with a unified, robust system."><meta property="og:image" content="https://cwru-sdle.github.io/geospatialsuite/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">geospatialsuite</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/vegetation-indices.html">Vegetation Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/agricultural-analysis.html">Agricultural Applications</a></li>
    <li><a class="dropdown-item" href="../articles/analyze-crop-vegetation.html">Analyzing Crop Vegetation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/spatial-analysis.html">Spatial Operations</a></li>
    <li><a class="dropdown-item" href="../articles/spatial-integration.html">Spatial Integration</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/water-quality.html">Water Quality Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/workflows-case-studies.html">Complete Workflows</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cwru-sdle/geospatialsuite" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../paper.html">JOSS Paper</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Universal Spatial Join - Complete Implementation</h1>
      <small class="dont-index">Source: <a href="https://github.com/cwru-sdle/geospatialsuite/blob/main/R/06-spatial-join.R" class="external-link"><code>R/06-spatial-join.R</code></a></small>
      <div class="d-none name"><code>universal_spatial_join.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Comprehensive spatial join system that handles ALL spatial data combinations:
Vector to Vector, Vector to Raster, Raster to Raster with full documentation,
error handling, and extensive examples. This replaces all previous spatial
join functions with a unified, robust system.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">universal_spatial_join</span><span class="op">(</span></span>
<span>  <span class="va">source_data</span>,</span>
<span>  <span class="va">target_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  scale_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  summary_function <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  buffer_distance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  temporal_tolerance <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  crs_target <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na_strategy <span class="op">=</span> <span class="st">"remove"</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">1e+06</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-source-data">source_data<a class="anchor" aria-label="anchor" href="#arg-source-data"></a></dt>
<dd><p>Source spatial data. Can be:</p><ul><li><p>File path: "/path/to/data.tif" or "/path/to/data.shp"</p></li>
<li><p>Directory: "/path/to/spatial_files/" (processes all spatial files)</p></li>
<li><p>R object: SpatRaster, sf object, data.frame with coordinates</p></li>
<li><p>List: Multiple files, raster stack, or sf objects</p></li>
</ul></dd>


<dt id="arg-target-data">target_data<a class="anchor" aria-label="anchor" href="#arg-target-data"></a></dt>
<dd><p>Target spatial data (same format options as source_data).
Can be NULL for scaling operations with scale_factor.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Spatial join method:</p><ul><li><p><strong>"auto"</strong>: Automatically detect best method (default)</p></li>
<li><p><strong>"extract"</strong>: Extract raster values to vector features</p></li>
<li><p><strong>"overlay"</strong>: Spatial intersection/overlay of vectors</p></li>
<li><p><strong>"resample"</strong>: Resample raster to match target geometry</p></li>
<li><p><strong>"zonal"</strong>: Calculate zonal statistics (raster â†’ vector)</p></li>
<li><p><strong>"nearest"</strong>: Nearest neighbor spatial join</p></li>
<li><p><strong>"interpolate"</strong>: Spatial interpolation (IDW, kriging)</p></li>
<li><p><strong>"temporal"</strong>: Time-aware spatial join</p></li>
</ul></dd>


<dt id="arg-scale-factor">scale_factor<a class="anchor" aria-label="anchor" href="#arg-scale-factor"></a></dt>
<dd><p>Numeric (&gt; 0 if provided). Scale factor for resolution changes:</p><ul><li><p><code>NULL</code>: Use target data resolution (default)</p></li>
<li><p><code>&gt; 1</code>: Coarser resolution (e.g., 2 = half resolution)</p></li>
<li><p><code>&lt; 1</code>: Finer resolution (e.g., 0.5 = double resolution)</p></li>
<li><p>Custom: Any positive number for specific scaling</p></li>
</ul></dd>


<dt id="arg-summary-function">summary_function<a class="anchor" aria-label="anchor" href="#arg-summary-function"></a></dt>
<dd><p>Character. Function for aggregating overlapping values:</p><ul><li><p><strong>"mean"</strong>: Average values (default for continuous data)</p></li>
<li><p><strong>"median"</strong>: Median values (robust to outliers)</p></li>
<li><p><strong>"max"</strong>/<strong>"min"</strong>: Maximum/minimum values</p></li>
<li><p><strong>"sum"</strong>: Sum values (useful for counts, areas)</p></li>
<li><p><strong>"sd"</strong>: Standard deviation (measure variability)</p></li>
<li><p><strong>"mode"</strong>/<strong>"majority"</strong>: Most frequent value (categorical data)</p></li>
</ul></dd>


<dt id="arg-buffer-distance">buffer_distance<a class="anchor" aria-label="anchor" href="#arg-buffer-distance"></a></dt>
<dd><p>Numeric (&gt;= 0 if provided). Buffer distance in map units:</p><ul><li><p>For point extraction: Buffer around points</p></li>
<li><p>For line extraction: Buffer along lines</p></li>
<li><p>For nearest neighbor: Search radius</p></li>
<li><p>Units: Same as source data CRS (meters, degrees, etc.)</p></li>
</ul></dd>


<dt id="arg-temporal-tolerance">temporal_tolerance<a class="anchor" aria-label="anchor" href="#arg-temporal-tolerance"></a></dt>
<dd><p>Numeric (&gt;= 0 if provided). Time tolerance for temporal joins (in days):</p><ul><li><p>Maximum time difference for matching observations</p></li>
<li><p>Only used with method = "temporal"</p></li>
<li><p>Example: 7 = match within 7 days</p></li>
</ul></dd>


<dt id="arg-crs-target">crs_target<a class="anchor" aria-label="anchor" href="#arg-crs-target"></a></dt>
<dd><p>Character or numeric. Target coordinate reference system:</p><ul><li><p>EPSG code: 4326, 3857, etc.</p></li>
<li><p>PROJ string: "+proj=utm +zone=33 +datum=WGS84"</p></li>
<li><p>NULL: Use source data CRS (default)</p></li>
</ul></dd>


<dt id="arg-na-strategy">na_strategy<a class="anchor" aria-label="anchor" href="#arg-na-strategy"></a></dt>
<dd><p>Character. Strategy for handling NA values:</p><ul><li><p><strong>"remove"</strong>: Keep NAs as missing (default)</p></li>
<li><p><strong>"nearest"</strong>: Replace with nearest neighbor value</p></li>
<li><p><strong>"interpolate"</strong>: Spatial interpolation of NAs</p></li>
<li><p><strong>"zero"</strong>: Replace NAs with zero</p></li>
</ul></dd>


<dt id="arg-chunk-size">chunk_size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>Numeric (&gt; 0). Chunk size for processing large datasets:</p><ul><li><p>Number of features/cells to process at once</p></li>
<li><p>Larger = faster but more memory</p></li>
<li><p>Smaller = slower but less memory</p></li>
<li><p>Default: 1,000,000</p></li>
</ul></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical. Use parallel processing:</p><ul><li><p>TRUE: Use multiple cores (faster for large data)</p></li>
<li><p>FALSE: Single core processing (default)</p></li>
<li><p>Requires 'parallel' package</p></li>
</ul></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. Print detailed progress messages:</p><ul><li><p>TRUE: Show processing steps and diagnostics</p></li>
<li><p>FALSE: Silent processing (default)</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Spatial data object with joined attributes. Return type depends on operation:</p><dl><dt>extract (vector â†’ raster)</dt>
<dd><p>sf object with new columns containing extracted raster values. Original geometry preserved, new columns named "extracted_" followed by the raster layer name</p></dd>

<dt>zonal (raster â†’ vector)</dt>
<dd><p>sf object with new columns containing zonal statistics. Original geometry preserved, new columns named "zonal_" followed by the statistic name and raster layer name</p></dd>

<dt>resample (raster â†’ raster)</dt>
<dd><p>SpatRaster with resampled/processed data matching target resolution or scale factor</p></dd>

<dt>overlay (vector â†’ vector)</dt>
<dd><p>sf object with intersected/overlaid features combining attributes from both datasets</p></dd>

<dt>nearest</dt>
<dd><p>sf object with attributes from nearest features joined</p></dd>


</dl><p><strong>Returned objects include 'spatial_join_info' attribute containing:</strong></p><ul><li><p>method: Join method used</p></li>
<li><p>source_type, target_type: Data types processed</p></li>
<li><p>processing_time: Time taken (if verbose=TRUE)</p></li>
<li><p>timestamp: Processing timestamp</p></li>
<li><p>summary_function: Aggregation function used</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="quick-start-guide-">Quick Start Guide:<a class="anchor" aria-label="anchor" href="#quick-start-guide-"></a></h3>


<p>Most common use case - extract raster values to point locations:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/universal_spatial_join.html">universal_spatial_join</a></span><span class="op">(</span><span class="st">"my_points.csv"</span>, <span class="st">"my_raster.tif"</span>, method<span class="op">=</span><span class="st">"extract"</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="supported-operations-">Supported Operations:<a class="anchor" aria-label="anchor" href="#supported-operations-"></a></h3>

<div class="section">
<h4 id="data-type-combinations-">Data Type Combinations:<a class="anchor" aria-label="anchor" href="#data-type-combinations-"></a></h4>

<ul><li><p><strong>Vector â†’ Raster</strong>: Extract raster values to points/polygons/lines</p></li>
<li><p><strong>Raster â†’ Vector</strong>: Calculate zonal statistics for polygons</p></li>
<li><p><strong>Raster â†’ Raster</strong>: Resample, overlay, mathematical operations</p></li>
<li><p><strong>Vector â†’ Vector</strong>: Spatial intersections, overlays, nearest neighbor</p></li>
</ul></div>

<div class="section">
<h4 id="input-format-support-">Input Format Support:<a class="anchor" aria-label="anchor" href="#input-format-support-"></a></h4>

<ul><li><p><strong>File paths</strong>: ".tif", ".shp", ".gpkg", ".geojson", ".nc"</p></li>
<li><p><strong>Directories</strong>: Automatically processes all spatial files</p></li>
<li><p><strong>R objects</strong>: SpatRaster, sf, data.frame with coordinates</p></li>
<li><p><strong>Lists</strong>: Multiple files or raster stacks</p></li>
</ul></div>

<div class="section">
<h4 id="scaling-operations-">Scaling Operations:<a class="anchor" aria-label="anchor" href="#scaling-operations-"></a></h4>

<ul><li><p><strong>Up-scaling</strong>: Aggregate to coarser resolution (scale_factor &gt; 1)</p></li>
<li><p><strong>Down-scaling</strong>: Interpolate to finer resolution (scale_factor &lt; 1)</p></li>
<li><p><strong>Custom resolution</strong>: Match target raster geometry</p></li>
</ul></div>

<div class="section">
<h4 id="error-handling-">Error Handling:<a class="anchor" aria-label="anchor" href="#error-handling-"></a></h4>

<ul><li><p><strong>Auto CRS reprojection</strong>: Handles coordinate system mismatches</p></li>
<li><p><strong>Geometry alignment</strong>: Auto-crops, extends, or resamples as needed</p></li>
<li><p><strong>NA handling</strong>: Multiple strategies for missing data</p></li>
<li><p><strong>Memory management</strong>: Chunked processing for large datasets</p></li>
</ul></div>

<div class="section">
<h4 id="method-selection-guide-">Method Selection Guide:<a class="anchor" aria-label="anchor" href="#method-selection-guide-"></a></h4>


<dl><dt>extract</dt>
<dd><p>Use when you have point/polygon locations and want to get values from a raster</p></dd>

<dt>zonal</dt>
<dd><p>Use when you have polygons and want statistics from raster data within each polygon</p></dd>

<dt>resample</dt>
<dd><p>Use when you need to change raster resolution or align two rasters</p></dd>

<dt>overlay</dt>
<dd><p>Use when joining two vector datasets based on spatial relationships</p></dd>

<dt>nearest</dt>
<dd><p>Use when you want to find the closest features between two vector datasets</p></dd>

<dt>auto</dt>
<dd><p>Let the function choose - works well for standard extract/resample operations</p></dd>


</dl></div>


</div>

    </div>
    <div class="section level2">
    <h2 id="common-error-solutions">Common Error Solutions<a class="anchor" aria-label="anchor" href="#common-error-solutions"></a></h2>


<dl><dt>CRS Mismatch</dt>
<dd><p>"CRS mismatch detected" - Function automatically reprojects data, but manual CRS checking recommended for precision</p></dd>

<dt>Memory Issues</dt>
<dd><p>"Large dataset processing" - Reduce chunk_size parameter (try 500000) or set parallel=FALSE</p></dd>

<dt>No Spatial Overlap</dt>
<dd><p>"No spatial overlap found" - Check that source and target data cover the same geographic area</p></dd>

<dt>File Not Found</dt>
<dd><p>"File does not exist" - Verify file paths and ensure files exist at specified locations</p></dd>

<dt>Missing Bands</dt>
<dd><p>"Required bands not found" - For raster operations, ensure expected spectral bands are present</p></dd>

<dt>Invalid Geometries</dt>
<dd><p>"Geometry errors" - Function attempts to fix automatically, but check input data quality</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="performance-tips">Performance Tips<a class="anchor" aria-label="anchor" href="#performance-tips"></a></h2>


<ul><li><p>For large datasets (&gt;1M cells): set chunk_size=500000 and parallel=TRUE</p></li>
<li><p>Use method="resample" with scale_factor &gt; 1 to reduce data size before complex operations</p></li>
<li><p>For time series analysis: consider temporal_tolerance to balance accuracy vs processing speed</p></li>
<li><p>When processing multiple datasets: ensure consistent CRS to avoid reprojection overhead</p></li>
<li><p>For point extraction: use smaller buffer_distance when possible to reduce processing time</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="raster_to_raster_ops.html">raster_to_raster_ops</a></code> for specialized raster operations</p></li>
<li><p><code><a href="multiscale_operations.html">multiscale_operations</a></code> for multi-scale analysis</p></li>
<li><p><code><a href="process_vector_data.html">process_vector_data</a></code> for vector data preprocessing</p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># These examples require satellite imagery files (Landsat/Sentinel data etc.)</span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span><span class="co"># MOST COMMON USE CASE: Extract raster values to CSV points</span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Your typical workflow: CSV file with coordinates + raster file</span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">universal_spatial_join</span><span class="op">(</span></span></span>
<span class="r-in"><span>  source_data <span class="op">=</span> <span class="st">"my_field_sites.csv"</span>,    <span class="co"># CSV with lon, lat columns</span></span></span>
<span class="r-in"><span>  target_data <span class="op">=</span> <span class="st">"satellite_image.tif"</span>,   <span class="co"># Any raster file</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"extract"</span>,                     <span class="co"># Extract raster values to points</span></span></span>
<span class="r-in"><span>  buffer_distance <span class="op">=</span> <span class="fl">100</span>,                  <span class="co"># 100m buffer around each point</span></span></span>
<span class="r-in"><span>  summary_function <span class="op">=</span> <span class="st">"mean"</span>,              <span class="co"># Average within buffer</span></span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>                          <span class="co"># See what's happening</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check results - original data + new columns with raster values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#   site_id       lon       lat           geometry extracted_satellite_image</span></span></span>
<span class="r-in"><span><span class="co"># 1       1 -83.12345  40.12345 POINT (-83.1 40.1)                   0.752</span></span></span>
<span class="r-in"><span><span class="co"># 2       2 -83.23456  40.23456 POINT (-83.2 40.2)                   0.681</span></span></span>
<span class="r-in"><span><span class="co"># 3       3 -83.34567  40.34567 POINT (-83.3 40.3)                   0.594</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access the extracted values</span></span></span>
<span class="r-in"><span><span class="va">results</span><span class="op">$</span><span class="va">extracted_satellite_image</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span><span class="co"># ZONAL STATISTICS: Calculate statistics by polygon areas</span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate average precipitation by watershed</span></span></span>
<span class="r-in"><span><span class="va">watershed_precip</span> <span class="op">&lt;-</span> <span class="fu">universal_spatial_join</span><span class="op">(</span></span></span>
<span class="r-in"><span>  source_data <span class="op">=</span> <span class="st">"precipitation_raster.tif"</span>,  <span class="co"># Raster data</span></span></span>
<span class="r-in"><span>  target_data <span class="op">=</span> <span class="st">"watershed_boundaries.shp"</span>,  <span class="co"># Polygon boundaries</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"zonal"</span>,                           <span class="co"># Calculate zonal statistics</span></span></span>
<span class="r-in"><span>  summary_function <span class="op">=</span> <span class="st">"mean"</span>,                  <span class="co"># Average precipitation per watershed</span></span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Result: polygons with precipitation statistics</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">watershed_precip</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#   watershed_id                     geometry zonal_mean_precipitation_raster</span></span></span>
<span class="r-in"><span><span class="co"># 1            1 POLYGON ((-84.2 40.1, ...))                             42.3</span></span></span>
<span class="r-in"><span><span class="co"># 2            2 POLYGON ((-84.5 40.3, ...))                             38.7</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span><span class="co"># RESAMPLE RASTER: Change resolution or align rasters</span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Aggregate 30m Landsat to 250m MODIS resolution</span></span></span>
<span class="r-in"><span><span class="va">landsat_resampled</span> <span class="op">&lt;-</span> <span class="fu">universal_spatial_join</span><span class="op">(</span></span></span>
<span class="r-in"><span>  source_data <span class="op">=</span> <span class="st">"landsat_30m.tif"</span>,      <span class="co"># High resolution input</span></span></span>
<span class="r-in"><span>  target_data <span class="op">=</span> <span class="st">"modis_250m.tif"</span>,       <span class="co"># Target resolution template</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"resample"</span>,                   <span class="co"># Resample operation</span></span></span>
<span class="r-in"><span>  summary_function <span class="op">=</span> <span class="st">"mean"</span>,             <span class="co"># Average when aggregating</span></span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check new resolution</span></span></span>
<span class="r-in"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">landsat_resampled</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># [1] 250 250</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Scale by factor instead of template</span></span></span>
<span class="r-in"><span><span class="va">coarser_raster</span> <span class="op">&lt;-</span> <span class="fu">universal_spatial_join</span><span class="op">(</span></span></span>
<span class="r-in"><span>  source_data <span class="op">=</span> <span class="st">"fine_resolution.tif"</span>,</span></span>
<span class="r-in"><span>  target_data <span class="op">=</span> <span class="cn">NULL</span>,                    <span class="co"># No template needed</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"resample"</span>,</span></span>
<span class="r-in"><span>  scale_factor <span class="op">=</span> <span class="fl">5</span>,                      <span class="co"># 5x coarser resolution</span></span></span>
<span class="r-in"><span>  summary_function <span class="op">=</span> <span class="st">"mean"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span><span class="co"># VECTOR OVERLAY: Join two vector datasets</span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Find which counties contain each field site</span></span></span>
<span class="r-in"><span><span class="va">sites_with_counties</span> <span class="op">&lt;-</span> <span class="fu">universal_spatial_join</span><span class="op">(</span></span></span>
<span class="r-in"><span>  source_data <span class="op">=</span> <span class="st">"field_sites.shp"</span>,      <span class="co"># Point data</span></span></span>
<span class="r-in"><span>  target_data <span class="op">=</span> <span class="st">"county_boundaries.shp"</span>, <span class="co"># Polygon data</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"overlay"</span>,                     <span class="co"># Spatial intersection</span></span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Result: points with county attributes added</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sites_with_counties</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#   site_id           geometry county_name state_name</span></span></span>
<span class="r-in"><span><span class="co"># 1       1 POINT (-83.1 40.1)    Franklin       Ohio</span></span></span>
<span class="r-in"><span><span class="co"># 2       2 POINT (-83.2 40.2)    Delaware       Ohio</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span><span class="co"># AUTO-DETECTION: Let function choose best method</span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Function automatically detects: points + raster = extract method</span></span></span>
<span class="r-in"><span><span class="va">auto_result</span> <span class="op">&lt;-</span> <span class="fu">universal_spatial_join</span><span class="op">(</span></span></span>
<span class="r-in"><span>  source_data <span class="op">=</span> <span class="va">my_points</span>,               <span class="co"># Any point data</span></span></span>
<span class="r-in"><span>  target_data <span class="op">=</span> <span class="va">my_raster</span>,               <span class="co"># Any raster data</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"auto"</span>,                       <span class="co"># Automatically choose method</span></span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>                         <span class="co"># See what method was chosen</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Output: "Auto-detected method: extract for vector to raster"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span><span class="co"># ERROR HANDLING EXAMPLES</span></span></span>
<span class="r-in"><span><span class="co"># =================================================================</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Function handles common issues automatically</span></span></span>
<span class="r-in"><span><span class="va">robust_result</span> <span class="op">&lt;-</span> <span class="fu">universal_spatial_join</span><span class="op">(</span></span></span>
<span class="r-in"><span>  source_data <span class="op">=</span> <span class="st">"points_wgs84.csv"</span>,     <span class="co"># WGS84 coordinate system</span></span></span>
<span class="r-in"><span>  target_data <span class="op">=</span> <span class="st">"raster_utm.tif"</span>,       <span class="co"># UTM coordinate system</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"extract"</span>,</span></span>
<span class="r-in"><span>  na_strategy <span class="op">=</span> <span class="st">"nearest"</span>,               <span class="co"># Handle missing values</span></span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>                         <span class="co"># See CRS handling messages</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Output: "CRS mismatch detected. Reprojecting to match raster CRS..."</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>geospatialsuite is developed by the <a href="https://engineering.case.edu/centers/sdle" class="external-link">SDLE Research Center</a> at Case Western Reserve University, supported by NSF CASFER (Award 2133576).</p>
</div>

<div class="pkgdown-footer-right">
  <p>Built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a></p>
</div>

    </footer></div>





  </body></html>

